<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    {include file="common/bits/css.ihtml" flex=1}
    <title>DEX | Ciornă Finanțe</title>

    {literal}
    <style type="text/css">
      #finTable {
        border-collapse: collapse;
        margin: 10px auto 0 auto;
      }
      #finTable tr td, #finTable tr th {
        border: 1px solid #ccc;
        padding: 2px 5px;
      }
      .number {
        text-align: right;
      }
      .weighted {
        font-size: 80%;
      }
    </style>
    {/literal}
  </head>

  <body>

    {include file="admin/header.ihtml" title="DEX online - Ciornă pentru finanțe"}
    {include file="admin/recentlyVisited.ihtml"}

    <form action="financials.php" method="get">
      <table>
        <tr>
          <td>Venit lunar (€):</td>
          <td><input type="text" name="income" value="{$income}"/></td>
        </tr>
        <tr>
          <td>Cursul valutar:</td>
          <td><input type="text" name="exchangeRate" value="{$exchangeRate}"/></td>
        </tr>
        <tr>
          <td>Ziua zero:</td>
          <td>
            {include file="common/bits/numericDropDown.ihtml" name="year" start=2001 end=`$currentYear+1` selected=$year}
            {include file="common/bits/numericDropDown.ihtml" name="month" start=1 end=13 selected=$month}
            {include file="common/bits/numericDropDown.ihtml" name="day" start=1 end=32 selected=$day}
          </td>
        </tr>
        <tr>
          <td><label for="allUsers">Toți utilizatorii:</label></td>
          <td><input type="checkbox" id="allUsers" name="allUsers" value="1" {if $allUsers}checked="checked"{/if}/></td>
        </tr>
      </table>
      <input type="submit" name="submitButton" value="Recalculează"/>
    </form>

    <table id="finTable">
      <tr>
        <td><b>Utilizator</b></td>
        {foreach from=$categories item=cat}
          <td class="number">
            <b>{$cat->name}</b><br/>
            {$cat->weight*100|string_format:"%.2f"}%
          </td>
        {/foreach}
        <td><b>Procent total<b></td>
        <td><b>Venit (€)<b></td>
        <td><b>Venit (lei)<b></td>
      </tr>
      {foreach from=$fins item=fin}
        {if $allUsers || $fin->share >= 0.001}
          <tr style="background: {cycle values="#f4f4f4,#fff"}">
            <td>{$fin->user->nick}</td>
            {foreach from=$fin->values item=value key=i}
              <td class="number">
                {if $value}
                  {if is_float($value)}
                    {$value*100|string_format:"%.2f"}%
                  {else}
                    {$value}
                  {/if}
                  <span class="weighted">({$fin->weights[$i]*$categories[$i]->weight*100|string_format:"%.2f"}%)</span>
                {/if}
              </td>
            {/foreach}
            <td class="number">{$fin->share*100|string_format:"%.2f"}%</td>
            <td class="number">{$income*$fin->share|string_format:"%.2f"}</td>
            <td class="number">{$income*$fin->share*$exchangeRate|string_format:"%.2f"}</td>
          </tr>
        {/if}
      {/foreach}
    </table>

    Observații:</br>
    <ul>
      <li>Sunt afișați numai utilizatorii cu un procent total mai mare decât 0.1%;</li>
      <li>Pe fiecare coloană, suma numerelor din paranteză este egală cu ponderea respectivei coloane;</li>
      <li>Procentul total al fiecărui utilizator este suma numerelor din paranteză de pe linia sa;</li>
      <li>Venitul lunar este pur fictiv;</li>
      <li>Ziua zero este ultima zi a „trecutului”. Contribuțiile din trecut sunt socotite până la ziua zero inclusiv.</li>
    </ul>

    Metodologie:<br/>
    <ul>
      <li><b>Caractere:</b> Se ignoră definițiile trimise de Radu pe 15.09.2007 (ziua când am importat MDN), precum și definițiile
      trimise de RACAI și siveco. Pentru restul definițiilor active, se calculează suma lungimilor definițiilor trimise de fiecare
      utilizator. Aceste cifre coincid cu cele din top, eventual cu mici diferențe, deoarece topul se calculează numai o dată pe zi.</li>

      <li><b>Restul:</b> Se împarte în mod egal „felia” pentru administrare (care include programarea, munca la flexor, răspunsul la emailuri și moderarea
      definițiilor).</li>
    </ul>

  </body>

</html>
